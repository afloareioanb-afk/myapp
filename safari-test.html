<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safari Compatibility Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007AFF;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056CC;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Safari Compatibility Test</h1>
    
    <div class="test-section">
        <h2>Feature Detection Tests</h2>
        <div id="feature-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>CSS Compatibility Tests</h2>
        <div id="css-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>JavaScript Functionality Tests</h2>
        <div id="js-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>Interactive Tests</h2>
        <button onclick="testClipboard()">Test Clipboard API</button>
        <button onclick="testFileDownload()">Test File Download</button>
        <button onclick="testHistoryAPI()">Test History API</button>
        <br><br>
        <input type="text" id="testInput" placeholder="Type something to test input handling">
        <div id="interactive-results"></div>
    </div>

    <script>
        // Feature detection tests
        function runFeatureTests() {
            const tests = [
                { name: 'URLSearchParams', test: () => typeof URLSearchParams !== 'undefined' },
                { name: 'Element.prototype.matches', test: () => typeof Element.prototype.matches === 'function' },
                { name: 'Element.prototype.closest', test: () => typeof Element.prototype.closest === 'function' },
                { name: 'navigator.clipboard', test: () => navigator.clipboard && typeof navigator.clipboard.writeText === 'function' },
                { name: 'Blob API', test: () => typeof Blob !== 'undefined' },
                { name: 'URL.createObjectURL', test: () => typeof URL !== 'undefined' && typeof URL.createObjectURL === 'function' },
                { name: 'history.replaceState', test: () => typeof history.replaceState === 'function' },
                { name: 'CSS Custom Properties', test: () => CSS.supports('color', 'var(--test)') },
                { name: 'Flexbox', test: () => CSS.supports('display', 'flex') },
                { name: 'CSS Grid', test: () => CSS.supports('display', 'grid') }
            ];
            
            const results = tests.map(test => ({
                name: test.name,
                passed: test.test()
            }));
            
            displayResults('feature-tests', results);
        }
        
        // CSS compatibility tests
        function runCSSTests() {
            const tests = [
                { name: 'Webkit Prefixes', test: () => CSS.supports('-webkit-appearance', 'none') },
                { name: 'Transform 3D', test: () => CSS.supports('transform', 'translate3d(0,0,0)') },
                { name: 'Backdrop Filter', test: () => CSS.supports('backdrop-filter', 'blur(10px)') },
                { name: 'CSS Variables', test: () => CSS.supports('color', 'var(--test)') }
            ];
            
            const results = tests.map(test => ({
                name: test.name,
                passed: test.test()
            }));
            
            displayResults('css-tests', results);
        }
        
        // JavaScript functionality tests
        function runJSTests() {
            const tests = [
                { name: 'Arrow Functions', test: () => (() => true)() },
                { name: 'Template Literals', test: () => `test ${'works'}` === 'test works' },
                { name: 'Destructuring', test: () => { const {a} = {a: 1}; return a === 1; }() },
                { name: 'Spread Operator', test: () => [...[1,2,3]].length === 3 },
                { name: 'Promise Support', test: () => typeof Promise !== 'undefined' },
                { name: 'Fetch API', test: () => typeof fetch !== 'undefined' }
            ];
            
            const results = tests.map(test => ({
                name: test.name,
                passed: test.test()
            }));
            
            displayResults('js-tests', results);
        }
        
        function displayResults(containerId, results) {
            const container = document.getElementById(containerId);
            container.innerHTML = results.map(result => 
                `<div class="${result.passed ? 'success' : 'error'}">
                    ${result.passed ? '✅' : '❌'} ${result.name}: ${result.passed ? 'Supported' : 'Not Supported'}
                </div>`
            ).join('');
        }
        
        // Interactive tests
        function testClipboard() {
            if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
                navigator.clipboard.writeText('Safari clipboard test').then(() => {
                    showResult('Clipboard API: Working ✅');
                }).catch(() => {
                    showResult('Clipboard API: Failed ❌');
                });
            } else {
                showResult('Clipboard API: Not supported ❌');
            }
        }
        
        function testFileDownload() {
            try {
                const blob = new Blob(['Test content'], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'test.txt';
                a.click();
                URL.revokeObjectURL(url);
                showResult('File Download: Working ✅');
            } catch (e) {
                showResult('File Download: Failed ❌ - ' + e.message);
            }
        }
        
        function testHistoryAPI() {
            try {
                const currentUrl = location.href;
                history.pushState({test: true}, 'Test', currentUrl + '#test');
                history.replaceState({test: false}, 'Test', currentUrl);
                showResult('History API: Working ✅');
            } catch (e) {
                showResult('History API: Failed ❌ - ' + e.message);
            }
        }
        
        function showResult(message) {
            const container = document.getElementById('interactive-results');
            const div = document.createElement('div');
            div.textContent = message;
            div.style.margin = '5px 0';
            container.appendChild(div);
        }
        
        // Input handling test
        document.getElementById('testInput').addEventListener('input', function(e) {
            showResult(`Input handling: Working ✅ - Value: "${e.target.value}"`);
        });
        
        // Run all tests when page loads
        window.addEventListener('load', function() {
            runFeatureTests();
            runCSSTests();
            runJSTests();
        });
    </script>
</body>
</html>


